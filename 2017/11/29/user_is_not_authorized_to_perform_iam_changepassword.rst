User is not authorized to perform iam:ChangePassword.
=====================================================

Summary: A user who is otherwise authorized to change their password may get
this error when attempting to change their password to a string which
violates the Password Policy in your IAM Account Settings.


So, I was setting up the 3rd or 4th user in a small team's AWS account, and I
did the usual: Go to the console, make a user,
auto-generate a password for them, tick "force them to change their password
on next login", chat them the password and an admonishment to change it ASAP.

It's a compromise between convenience and security that works for us at the
moment, since there's all of about 10 minutes during which the throwaway
credential could get intercepted by an attacker, and I'd have the instant
feedback of "that didn't work" if anyone but the intended recipient performed
the password change.

So, the 8th or 10th user I'm setting up, same way as all the others, gets that
error on the change password screen: "User is not authorized to perform
iam:ChangePassword". Oh no, did I do their permissions wrong? I try explicitly
attaching the Amazon's IAMUserChangePassword policy to them, because that
should fix their not being authorized, right? Wrong; they try again and
they're still "not authorized".

OK, I have their temp password because I just gave it to them, so I'll pop
open private browsing and try logging in as them.

When I try putting in the same autogenerated password at the reset screen, I
get "Password does not conform to the account password policy.". This makes
sense; there's a "prevent password reuse" policy enabled under Account
Settings within IAM.

OK, we won't reuse the password. I'll just set it to that most seekrit string,
"hunter2". Nope, the "User is not authorized to perform iam:ChangePassword" is
back. That's funny, but consistent with the rules just being checked in a
slightly funny order.

Then, on a hunch, I try the autogenerated password with a 1 at the end as the
new password. It changes just fine and allows me to log in! So, the user did
have authorization to change their password all along... they were just
getting an actively misleading error message about what was going wrong.

So, if you get this "User is not authorized to perform iam:ChangePassword"
error but you should be authorized, take a closer look at the temporary
password that was generated for you. Make sure that your new password matches or
exceeds the old one for having lowercase letters, uppercase letters, numbers,
special characters, and total length.

When poking at it some more, I discovered that one also gets the "User is not
authorized to perform iam:ChangePassword" message when one puts an invalid
value into the "current password" box on the change password screen. So, check
for typos there as well.

This yak shave took about an hour to pin down the fact that it was the
contents of the password string generating the permissions error, and I
haven't been able to find the error string in any of Amazon's actual
documentation, so hopefully I've said "User is not authorized to perform
iam:ChangePassword" enough times in this post that it pops up in search
results for anyone else frustrated by the same challenge.

.. author:: E. Dunham
.. categories:: none
.. tags:: aws
.. comments::
